<!doctype html>
<!-- inspiration: http://plnkr.co/edit/VFbP9h?p=preview -->
<html ng-app="myApp">
<head>
  <meta charset="utf-8">
  <title>LDT v0.2</title>
  <script>document.write("<base href=\"" + document.location + "\" />");</script>
  <link rel="stylesheet" href="css/jquery-ui.css">
  <link rel="stylesheet" href="css/style.css">
  <script src="lib/jquery-1.9.1.js"></script>
  <script src="lib/jquery-ui-1.10.3.js"></script>
  <script src="lib/angular/angular.js"></script>
  <script src="lib/underscore.js"></script>

  <script src="js/app.js"></script>
  <script src="js/services.js"></script>
  <script src="js/controllers/editor_controller.js"></script>
  <script src="js/controllers/graph_controller.js"></script>
  <script src="js/filters.js"></script>
  <script src="js/directives.js"></script>
</head>
<body ng-controller="EditorCtrl">

  <!-- DEBUG -->
  <!--
  <div ng-repeat="entity in graph.entities">
  Entity {{$index}}
  <input type="text" style="width:  40px" ng-model="entity.id"></input>
  <input type="text" style="width: 140px" ng-model="entity.name"></input>
  <input type="text" style="width:  40px" ng-model="entity.x"></input>
  <input type="text" style="width:  40px" ng-model="entity.y"></input>
  <input type="text" style="width:  40px" ng-model="entity.width"></input>
  <input type="text" style="width:  40px" ng-model="entity.height"></input>
  <input type="text" style="width: 140px" ng-model="entity.attributes"></input>
  </div>
  -->
  <div id="toolbar">
    <button action hotkey="s">Select</button>
    <button action hotkey="e">New Entity</button>
    <button action hotkey="r">New Relationship</button>
    <button action hotkey="d">Delete</button>
    <button action>Save</button>
    <span>{{editor.mode}}</span>
  </div>

  <!-- CANVAS element
  Scope watches: none
  UI events:
    select mode: left click deselects all entities, and potentially selects a relationship
    new entity mode: create entity
  -->
  <div canvas id="canvas" ng-controller="GraphCtrl" ng-click="handleCanvasClick($event)" ng-class="editor.mode">
    <div class="entity-border" ng-repeat="entity in graph.entities"
       move-with="entity" resize-with="entity" select-with="click as entity in #canvas"
       ng-style="{ left: entity.x, top: entity.y, width: entity.width, height: entity.height }">
      <div class="select-shield" catch-input ng-click="handleEntityClick(entity)">
        <br><br>{{editor.entityOverlayMessage}}
      </div>
      <div class="entity-heading" select-with="dblclick as heading in #canvas" auto-focus="input on dblclick">
        <span class="entity-name" ng-show="!heading.selected">{{entity.name}}</span>
        <input catch-input class="entity-name-input" ng-show="heading.selected" ng-model="entity.name">
      </div>
      <div class="entity-body" select-with="dblclick as body in #canvas" ng-style="{ height: (entity.height - 70) + 'px' }" forward-event="dblclick to textarea">
        <p class="attribute" ng-show="!body.selected" ng-repeat="attribute in graph.attributes[entity.id]" ng-class="attribute.class" ng-click="handleAttributeClick(entity.id,$index,$event)">{{attribute.text}}</p>
        <textarea catch-input class="attribute-input" ng-show="body.selected" ng-model="entity.attributes" ng-style="{ height: (entity.height - 70) + 'px' }"></textarea>
      </div>
    </div>

    <svg xmlns="http://www.w3.org/2000/svg" version="1.1">
      <path class="relationship" ng-repeat="r in graph.decoratedRelationships" ng-attr-d="{{r.svgPath()}}"></path>
      <path class="arrowhead"    ng-repeat="a in graph.arrowheads" ng-attr-d="{{a.path}}"></path>
      <path class="click-area"   ng-repeat="a in graph.arrowheads" ng-attr-d="{{a.box}}" ng-click="switchArrow(a,$event)"></path>
      <path class="click-path"   ng-repeat="r in graph.decoratedRelationships" ng-attr-d="{{r.svgPath()}}" ng-click="handleRelationshipClick(r)" catch-input></path>
    </svg>
  </div>

</body>
</html>
